{% extends "base.html" %}

{% block content %}
<h1>Chat with AI Agronomist</h1>
<div id="chat-history">
    {% for message in chat_history %}
        <p {% if message.is_user %}class="user-message"{% else %}class="ai-message"{% endif %}>
            {{ message.content }}
        </p>
    {% endfor %}
</div>
<form id="chat-form">
    <input type="text" id="user-input" name="message" required>
    <button type="submit">Send</button>
</form>

<script>
document.getElementById('chat-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var userInput = document.getElementById('user-input');
    var message = userInput.value;
    userInput.value = '';

    fetch('/chat', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'message=' + encodeURIComponent(message)
    })
    .then(response => response.json())
    .then(data => {
        var chatHistory = document.getElementById('chat-history');
        chatHistory.innerHTML += '<p class="user-message">' + data.user_message + '</p>';
        chatHistory.innerHTML += '<p class="ai-message">' + data.ai_response + '</p>';
        chatHistory.scrollTop = chatHistory.scrollHeight;
    });
});
</script>
{% endblock %}